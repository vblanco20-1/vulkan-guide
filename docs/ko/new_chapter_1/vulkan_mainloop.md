---
layout: default
title: Rendering Loop
parent:  "1. Initializing Vulkan - KO"
grand_parent: "Korean VKGuide"
nav_order: 40
---

이제 스왑체인과 커맨드 버퍼, 그리고 Vulkan이 모두 초기화되었습니다. 본격적으로 렌더링 루프를 작성할 차례입니다. 여기서는 `VkCmdClearColorImage`를 사용하여 프레임을 그리는 방식을 구현하겠습니다. 이렇게 하면 화면에 깜빡이는 색상이 나타날 것입니다. 이를 위해 스왑체인과 상호작용하여 이미지를 가져온 뒤, 지정한 색상으로 초기화하고 화면에 표시하겠습니다. 또한, OS와 GPU가 스왑체인 및 초기화 명령과 올바르게 동작하도록 동기화 구조체를 설정하겠습니다.

# 동기화
Vulkan은 CPU가 GPU의 명령 실행과 동기화할 수 있도록 명시적인 동기화 구조체를 제공합니다. 또한 GPU에서 실행되는 명령의 순서도 제어할 수 있습니다. 기본적으로는 명령이 큐 혹은 다른 명령을 통해 GPU로 전달되면 드라이버와 GPU가 이를 자유롭게 실행합니다. 여러 명령을 주어진 순서에 따라 실행하기를 원한다면 동기화 시스템을 구성해야 합니다. 이를 위해 Vulkan에서는 펜스(Fence)와 세마포어(Semaphore)를 제공합니다. 


## VkFence
이는 GPU에서 CPU방향으로의 동기화에 사용됩니다. `vkQueueSubmit`과 같은 여러 Vulkan 명령에서는 선택적으로 펜스 인자를 사용할 수 있습니다. 펜스를 설정하면, CPU에서 GPU가 해당 작업을 완료했는 지 확인할 수 있습니다. 펜스는 명령이 제출되면 신호(signal)가 설정되며, `VkWaitForFences`를 사용하여 CPU가 해당 명령이 실행될 때 까지 대기하도록 할 수 있습니다. 우리는 2개의 펜스를 사용할 것이고 이중 하나를 `FrameData` 구조체에 추가합시다.

<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;lightbox&quot;:false,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-10-31T14:18:38.316Z\&quot; agent=\&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/119.0\&quot; etag=\&quot;lo_08b3l49bzhgtzgSae\&quot; version=\&quot;22.0.8\&quot; type=\&quot;device\&quot;&gt;\n  &lt;diagram name=\&quot;Page-1\&quot; id=\&quot;yqtSi99kTGmy8T8GoYwj\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;1562\&quot; dy=\&quot;826\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; background=\&quot;#666666\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot; value=\&quot;\&quot; style=\&quot;shape=table;startSize=0;container=1;collapsible=0;childLayout=tableLayout;fontSize=16;labelBackgroundColor=#FF5252;fillColor=#999999;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;220\&quot; y=\&quot;590\&quot; width=\&quot;115\&quot; height=\&quot;360\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-74\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-75\&quot; value=\&quot;CPU\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-74\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-40\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;115\&quot; height=\&quot;110\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-41\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;font color=&amp;quot;#d9ffd1&amp;quot;&amp;gt;Record A&amp;lt;/font&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-40\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;110\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;110\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-44\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;140\&quot; width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-45\&quot; value=\&quot;&amp;lt;span style=&amp;quot;background-color: rgb(181, 115, 157);&amp;quot;&amp;gt;Submit A&amp;lt;/span&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-44\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-60\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;160\&quot; width=\&quot;115\&quot; height=\&quot;70\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-61\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#bfd2ff&amp;quot;&amp;gt;Record B&amp;lt;/font&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-60\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;70\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;70\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-48\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;230\&quot; width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-49\&quot; value=\&quot;&amp;lt;span style=&amp;quot;background-color: rgb(181, 115, 157);&amp;quot;&amp;gt;Submit B&amp;lt;/span&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-48\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-62\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;250\&quot; width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-63\&quot; value=\&quot;Wait Fence A\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-62\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-64\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;280\&quot; width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-65\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#d9ffd1&amp;quot;&amp;gt;Record A&amp;lt;/font&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-64\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-66\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;310\&quot; width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-67\&quot; value=\&quot;&amp;lt;span style=&amp;quot;background-color: rgb(181, 115, 157);&amp;quot;&amp;gt;Submit A&amp;lt;/span&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-66\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;20\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-68\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-39\&quot;&gt;\n          &lt;mxGeometry y=\&quot;330\&quot; width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-69\&quot; value=\&quot;Wait Fence B\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-68\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-53\&quot; value=\&quot;\&quot; style=\&quot;shape=table;startSize=0;container=1;collapsible=0;childLayout=tableLayout;fontSize=16;gradientColor=none;fillColor=#999999;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;335\&quot; y=\&quot;590\&quot; width=\&quot;115\&quot; height=\&quot;410\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-72\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-53\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-73\&quot; value=\&quot;&amp;lt;div&amp;gt;GPU&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-72\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-54\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-53\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;115\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-55\&quot; value=\&quot;&amp;lt;div&amp;gt;IDLE&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-54\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;130\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-56\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-53\&quot;&gt;\n          &lt;mxGeometry y=\&quot;160\&quot; width=\&quot;115\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-57\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#d9ffd1&amp;quot;&amp;gt;DRAW A&amp;lt;/font&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-56\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;120\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-58\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-53\&quot;&gt;\n          &lt;mxGeometry y=\&quot;280\&quot; width=\&quot;115\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-59\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#bfd2ff&amp;quot;&amp;gt;Draw B&amp;lt;/font&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-58\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;80\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-70\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=#D9FFD1;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-53\&quot;&gt;\n          &lt;mxGeometry y=\&quot;360\&quot; width=\&quot;115\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-71\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#d9ffd1&amp;quot;&amp;gt;Draw A&amp;lt;/font&amp;gt;\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;\&quot; vertex=\&quot;1\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-70\&quot;&gt;\n          &lt;mxGeometry width=\&quot;115\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle width=\&quot;115\&quot; height=\&quot;50\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-76\&quot; value=\&quot;\&quot; style=\&quot;shape=flexArrow;endArrow=classic;html=1;rounded=0;fillColor=default;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;490\&quot; y=\&quot;600\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n            &lt;mxPoint x=\&quot;490\&quot; y=\&quot;980\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;PtSh_AAYsrMjZ6H8d2Ia-77\&quot; value=\&quot;&amp;lt;div&amp;gt;TIME&amp;lt;/div&amp;gt;\&quot; style=\&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];\&quot; vertex=\&quot;1\&quot; connectable=\&quot;0\&quot; parent=\&quot;PtSh_AAYsrMjZ6H8d2Ia-76\&quot;&gt;\n          &lt;mxGeometry x=\&quot;0.2737\&quot; y=\&quot;-4\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint as=\&quot;offset\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n&lt;/mxfile&gt;\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>


의사 코드 예제:
```cpp
//we have a fence object created from somewhere
VkFence myFence;

//start some operation on the GPU
VkSomeOperation(whatever, myFence);

// block the CPU until the GPU operation finishes
VkWaitForFences(myFence);
//fences always have to be reset before they can be used again
VkResetFences(myFence);
```


## VkSemaphore
이는 GPU 내부 연산 간 동기화에 사용됩니다. 세마포어는 GPU 명령의 실행 순서를 정의하여 순차적으로 실행되도록 제어합니다. `VkQueueSubmit`과 같은 몇몇 Vulkan 명령은 신호(Signal) 혹은 대기(Wait) 세마포어를 지원합니다.

세마포어는 여러 GPU 큐 명령 간 연결 역할을 합니다. 하나의 명령은 설정한 세마포어를 신호하며, 다른 명령은 이를 대기합니다. 여러 GPU 명령이 하나의 세마포어를 대기하는 것도 가능하지만, 한 명령에 하나의 세마포어만을 신호할 수 있습니다. 명령이 세마포어를 대기한다면 해당 세마포어에 신호가 올 때 까지 실행되지 않습니다.

3가지 명령을 직렬화하는 의사 코드 예제:
```cpp
VkSemaphore Task1Semaphore;
VkSemaphore Task2Semaphore;

VkOperationInfo OpAlphaInfo;
// Operation Alpha will signal the semaphore 1
OpAlphaInfo.signalSemaphore = Task1Semaphore;

VkDoSomething(OpAlphaInfo);

VkOperationInfo OpBetaInfo;

// Operation Beta signals semaphore 2, and waits on semaphore 1
OpBetaInfo.signalSemaphore = Task2Semaphore;
OpBetaInfo.waitSemaphore = Task1Semaphore;

VkDoSomething(OpBetaInfo);

VkOperationInfo OpGammaInfo;
//Operation gamma waits on semaphore 2
OpGammaInfo.waitSemaphore = Task2Semaphore;

VkDoSomething(OpGammaInfo);
```

이 코드는 3개의 DoSomething을 GPU에서 엄격한 순서로 실행합니다. GPU에서 실행되는 명령의 순서는 Alpha->Beta->Gamma입니다. Alpha가 실행되면 Task1을 신호하고, 이는 Beta를 실행시켜 Beta가 실행을 마치면 마지막으로 Gamma를 신호할 것입니다.

이 경우 세마포어를 사용하지 않는다면 3개의 명령은 병렬로 실행되어 서로 얽혀 실행될 수 있습니다. 서로 다른 큐 간 명령에도 세마포어를 사용할 수 있습니다. 예를 들어 메인 그래픽스 큐가 특정 패스를 처리하는 동안 백그라운드에서는 컴퓨트 셰이더를 실행할 수도 있습니다. 또는 이미지를 화면에 출력하는 표시(Present) 큐와 이미지를 그리는 그래픽스 큐를 동기화하는 데 사용할 수도 있습니다.

# 렌더링 루프
우리의 렌더링 루프에서는 더블 버퍼링 구조체를 사용합니다. 이렇게 하면 GPU가 한 프레임 분량의 명령을 수행하는 동안 CPU가 다음 프레임을 준비할 수 있습니다. 하지만 다음 프레임이 계산되면 첫 프레임이 실행 완료되어 커맨드 버퍼에 다시 기록할 수 있을 때 까지 CPU는 대기해야 합니다.

렌더링 작업에서는 스왑체인과 동기화를 해야합니다. 화면에 표시할 필요가 없는 헤드리스 렌더링이라면, 이 과정이 필요 없습니다. 하지만 우리는 창에 렌더링해야 하므로 OS에서 사용할 이미지를 요청해야 합니다. 그리고 해당 이미지에 렌더링한 후, 그 이미지를 화면에 표시하도록 OS에 알려주어야 합니다.

# 이미지 레이아웃
GPU는 메모리에 이미지를 상황에 따라 다른 포맷으로 저장합니다. Vulkan에서는 이러한 포맷을 이미지 레이아웃이라는 개념으로 추상화합니다. 읽기 전용 이미지는 쓰기 가능한 이미지와 다른 레이아웃을 갖습니다. 이미지의 레이아웃을 변경할 때 Vulkan은 파이프라인 배리어를 사용합니다. 파이프라인 배리어는 단일 커맨드 버퍼 내에서 명령을 동기화하는 기능을 제공할 뿐만 아니라, 이미지 레이아웃 변환도 수행할 수 있습니다. 이미지 레이아웃이 하드웨어마다 다르게 구현되기 때문에, 일부 변환은 특정 하드웨어에서 실제로 아무런 동작도 하지 않을 수 있습니다. 올바른 변환을 수행하려면 검증 레이어를 사용하여 GPU 명령이 적절한 레이아웃에서 실행되는지 확인해야 합니다.검증 레이어를 사용하지 않는다면, NVIDIA 하드웨어에서는 정상적으로 작동하더라도 AMD나 다른 하드웨어에서는 문제가 생길 수 있습니다.

스왑체인에서 가져오는 이미지는 유효하지 않은 상태일 것입니다. 따라서 해당 이미지에 `VkCmdDraw` 혹은 다른 그리기 명령을 수행하려면, 먼저 이미지의 레이아웃을 쓰기 가능한 레이아웃으로 변환해야 합니다. 그리고 그리기 명령을 수행한 후에는, 최종적으로 화면 출력에 적합한 레이아웃으로 변환해야 합니다.

구버전의 Vulkan에서는 이러한 레이아웃 변환이 렌더패스의 일부로 처리되었습니다. 하지만 Vulkan 1.3에서는 동적 렌더링을 사용합니다. 이러한 변환을 직접 처리해야 한다는 뜻입니다. 반면에, 전체 렌더패스 구성할 때 복잡성과 작업량을 줄일 수 있습니다. 렌더패스에 대해 더 알고 싶다면 구버전의 [튜토리얼](https://vkguide.dev/docs/chapter-1/vulkan_renderpass/)을 확인하세요.



이제 렌더링 루프 코드를 살펴보겠습니다.

Next: [ Mainloop Code]({{ site.baseurl }}{% link docs/ko/new_chapter_1/vulkan_mainloop_code.md %})  

{% include comments.html term="Vkguide 2 Korean Comments" %}
